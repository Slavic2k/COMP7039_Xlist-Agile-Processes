<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<title>Market Movers - Platinum</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
        }
        header {
            background-color: #2d3e50;
            color: #fff;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .site-title {
            font-size: 2em;
            font-weight: bold;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropbtn {
            background-color: #2d3e50;
            color: white;
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            cursor: pointer;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .dropdown-content a {
            color: #2d3e50;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .dropdown-content a:hover {
            background-color: #ddd;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .dropdown:hover .dropbtn {
            background-color: #1a2533;
        }
        .content {
            padding: 40px 20px;
        }
        .textbox {
            width: 100%;
            max-width: 600px;
            height: 150px;
            font-size: 1em;
            padding: 10px;
            margin: 0 auto;
            display: block;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
    </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.0"></script>
</head>
<body>
      <header>
        <div class="site-title">Market Movers</div>
        <div class="dropdown">
            <button class="dropbtn">Menu</button>
            <div class="dropdown-content">
                <a href="home.html">Home</a>
                <a href="gold.html">Gold</a>
                <a href="silver.html">Silver</a>
                <a href="platinum.html">Platinum</a>
                <a href="palladium.html">Palladium</a>
                <a href="lead.html">Lead</a>
                <a href="copper.html">Copper</a>
                <a href="aluminium.html">Aluminium</a>
                <a href="nickel.html">Nickel</a>
            </div>
        </div>
    </header>
  <h2>Platinum Price over time (USD/oz)</h2>
  <canvas id="priceChart" width="800" height="300"></canvas>
  <h1>test</h1>
  <p>Platinum facts go here</p>
  <script>
    async function fetchCSVData() {
      const response = await fetch('data/platinum.csv');
      const text = await response.text();
      console.log('Raw CSV text:', text);

      const rows = text.trim().split('\n');
      console.log('Parsed rows:', rows);

      const dataPoints = [];

      rows.forEach((row, index) => {
        console.log(`Row ${index}:`, row);
const match = row.match(/^(\d{2}\/\d{2}\/\d{4}),"?([\d,\.]+)"?/);
        if (match) {
          const [month, day, year] = match[1].split('/');
          const isoDate = `${year}-${month}-${day}`;
          const price = parseFloat(match[2].replace(/,/g, ''));
          if (!isNaN(price)) {
            dataPoints.push({ x: isoDate, y: price });
          } else {
            console.warn(`Row ${index}: Invalid price "${match[2]}"`);
          }
        } else {
          console.warn(`Row ${index}: No match for "${row}"`);
        }
      });

      return dataPoints.reverse(); // chronological order
    }

    async function renderChart() {
      const dataPoints = await fetchCSVData();
      console.log('Final data points:', dataPoints);

      const ctx = document.getElementById('priceChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
datasets: [{
  label: 'Price ($/oz t)',
  data: dataPoints,
  borderColor: 'rgba(196, 193, 195, 0.8)',
  backgroundColor: 'rgba(225, 221, 223, 0.8)',
  fill: true,
  tension: 0.3,
  pointRadius: 0,
  pointHoverRadius: 5
}]

        },
options: {
  interaction: {
    mode: 'index',
    intersect: false
  },
  scales: {
x: {
  type: 'time',
  time: {
    unit: 'month',
    round: 'month',
    tooltipFormat: 'dd LLL yyyy',
    displayFormats: {
      month: 'MMM yyyy' // e.g., Jan 2025
    }
  },
  ticks: {
    source: 'data' // use actual data points for ticks
  },
  title: {
    display: true,
    text: 'Date'
  }
}
,
y: {
  title: {
    display: true,
    text: 'Price (â‚¬)'
  },
  beginAtZero: true,
  min: 0,
  max: 2500
}

  }
}

      });
    }

    renderChart();
  </script>
</body>
</html>
